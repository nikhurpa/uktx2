<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Terra Draw + Google Maps</title>
    <style>
      html, body { height: 100%; margin: 0; }
      #map { width: 100%; height: 100%; }
      #toolbar {
        position: absolute; top: 10px; left: 10px; z-index: 1000;
        background: white; padding: 6px; border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      }
      #toolbar button {
        margin: 2px; padding: 6px 10px;
        border: none; border-radius: 4px;
        background: #0078d7; color: white; cursor: pointer;
      }
      #toolbar button:hover { background: #005fa3; }
    </style>

    <!-- ✅ Load Google Maps API directly (no loader needed) -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAH06384nr0EpGqBZXDmkbGxHoWtpKjGPE"></script>

    <!-- ✅ Load TerraDraw core -->
    <script src="https://unpkg.com/terra-draw/dist/terra-draw.umd.js"></script>

    <!-- ✅ Load TerraDraw Google Maps adapter -->
    <script src="https://unpkg.com/terra-draw-google-maps-adapter/dist/terra-draw-google-maps-adapter.umd.js"></script>
  </head>
  <body>
    <div id="map"></div>
    <div id="toolbar">
      <button id="lineBtn">Draw Line</button>
      <button id="stopBtn">Stop</button>
    </div>

    <!-- ✅ Your script goes AFTER TerraDraw is loaded -->
    <script>
      function initMap() {

        console.log('TerraDraw global:', window.TerraDraw); 

        const map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 0, lng: 0 },
          zoom: 2,
        });

        // TerraDraw is available globally now
        const draw = new terraDraw.TerraDraw({
          adapter: new terraDrawGoogleMapsAdapter.TerraDrawGoogleMapsAdapter({ map }),
          modes: [
            new terraDraw.TerraDrawLineStringMode({ doubleClick: true, freehand: true })
          ],
        });

        draw.start();

        document.getElementById("lineBtn").onclick = () => draw.setMode("linestring");
        document.getElementById("stopBtn").onclick = () => draw.setMode("static");

        map.addListener("dblclick", () => {
          console.log("Line completed:", draw.getSnapshot());
          draw.setMode("static");
        });
      }

      window.onload = initMap;
    </script>
  </body>
</html>
